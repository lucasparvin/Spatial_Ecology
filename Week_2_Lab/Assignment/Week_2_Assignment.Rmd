---
title: "Publishable, reproducible map of sample sites"
output: html_notebook
---

# Load Useful Packages
```{r}
require(tidyverse)
require(sf)
require(tigris)
require(geodata)
require(ggplot2)
require(terra)
require(colorspace)
require(tidyterra)
require(ggnewscale)
require(cowplot)
```

# Plot Autauga WMA Shapefile
```{r}

# URL of the zipped shapefile on GitHub
url <- "https://github.com/lucasparvin/Spatial_Ecology/raw/main/Week_2_Lab/Assignment/AutaugaWMA.zip"

# Download the file
download.file(url, destfile = "AutaugaWMA.zip", mode = "wb")

# Unzip the file
unzip("AutaugaWMA.zip", exdir = "AutaugaWMA")


# Load the shapefile
autauga_wma <- vect("AutaugaWMA/AutaugaWMA/AutaugaWMA.shp")




# URL of the zipped raster data on GitHub
url <- "https://github.com/lucasparvin/Spatial_Ecology/raw/main/Week_2_Lab/Assignment/autaugalc.zip"

# Download the file
download.file(url, destfile = "autaugalc.zip", mode = "wb")

# Unzip the file
unzip("autaugalc.zip", exdir = "autaugalc")

# Load the raster data (adjust the path if needed)
landcover_raster <- rast("autaugalc/autaugalc") # Replace 'your_raster_folder' with the actual folder name



# Load Alabama shape
alabama <- states() %>% 
  filter(NAME == 'Alabama')

# Extract the CRS from the Alabama shape in WKT format
crs_alabama_wkt <- st_crs(alabama)$wkt

# Transform the CRS of Autauga WMA
autauga_wma_transformed <- terra::project(autauga_wma, crs_alabama_wkt)



```
# Zoomed Out Plot Without extent rectangle
```{r}
library(tidyverse)
library(sf)
library(terra)
library(tigris)

# Load and transform Autauga WMA shapefile
autauga_wma <- vect("AutaugaWMA/AutaugaWMA/AutaugaWMA.shp")
crs_alabama <- crs(states() %>% filter(NAME == 'Alabama'))
autauga_wma_transformed <- terra::project(autauga_wma, crs_alabama)
autauga_wma_sf <- st_as_sf(autauga_wma_transformed)

# Load and transform landcover raster
landcover_raster <- rast("autaugalc/autaugalc")
landcover_raster_transformed <- project(landcover_raster, crs_alabama)
raster_df <- as.data.frame(landcover_raster_transformed, xy = TRUE)
colnames(raster_df) <- c("x", "y", "value")

# Load Alabama shape as sf object
alabama_sf <- states() %>% 
  filter(NAME == 'Alabama') %>% 
  st_as_sf()



# Define plot
ggplot() +
  # Plot the raster
  geom_raster(data = raster_df, aes(x = x, y = y, fill = value)) +
  scale_fill_viridis_c() +  # Color scale for raster
  
  # Overlay Alabama shape
  geom_sf(data = alabama_sf, fill = NA, color = "black", size = 0.5) +
  
  # Overlay Autauga WMA
  geom_sf(data = autauga_wma_sf, fill = NA, color = "red", size = 0.5) +
  
  # Define plot labels and limits
  ggtitle("Alabama with Landcover and Autauga WMA") +
  coord_sf() +  # Adjust coordinate system
  
  # Adjust plot theme
  theme_minimal()



```

#Adding extent rectangle
```{r}
# Calculate the bounding box (extent) of autauga_wma_sf
wma_bbox <- st_bbox(autauga_wma_sf)


ggplot() +
  # Plot the raster
  geom_raster(data = raster_df, aes(x = x, y = y, fill = value)) +
  scale_fill_viridis_c() +  # Color scale for raster
  
  # Overlay Alabama shape
  geom_sf(data = alabama_sf, fill = NA, color = "black", linewidth = 0.5) +
  
  # Overlay Autauga WMA
  geom_sf(data = autauga_wma_sf, fill = NA, color = "red", linewidth = 0.5) +
  
  # Add an extent rectangle for Autauga WMA
  geom_rect(aes(xmin = wma_bbox$xmin, xmax = wma_bbox$xmax,
                ymin = wma_bbox$ymin, ymax = wma_bbox$ymax),
            color = "blue", fill = NA, linetype = "dashed", linewidth = 0.5) +
  
  # Define plot labels and limits
  ggtitle("Alabama with Landcover and Autauga WMA") +
  coord_sf() +  # Adjust coordinate system
  
  # Adjust plot theme
  theme_minimal()



```

# Zooming to extent

```{r}
# Calculate the bounding box (extent) of autauga_wma_sf
wma_bbox <- st_bbox(autauga_wma_sf)

ggplot() +
  # Plot the raster with zoomed extent
  geom_raster(data = raster_df, aes(x = x, y = y, fill = value)) +
  scale_fill_viridis_c() +
  
  # Overlay Alabama shape
  geom_sf(data = alabama_sf, fill = NA, color = "black", linewidth = 0.5) +
  
  # Overlay Autauga WMA
  geom_sf(data = autauga_wma_sf, fill = NA, color = "red", linewidth = 0.5) +
  
  # Add an extent rectangle for Autauga WMA (optional, as we're zooming in)
  geom_rect(aes(xmin = wma_bbox$xmin, xmax = wma_bbox$xmax,
                ymin = wma_bbox$ymin, ymax = wma_bbox$ymax),
            color = "blue", fill = NA, linetype = "dashed", linewidth = 0.5) +
  
  # Define plot labels
  ggtitle("Zoomed into Autauga WMA with Landcover") +
  
  # Zoom into the WMA extent
  coord_sf(xlim = c(wma_bbox$xmin, wma_bbox$xmax), 
           ylim = c(wma_bbox$ymin, wma_bbox$ymax), expand = FALSE) +
  
 # Adjust plot theme
  theme_minimal()


```



# Reclassifying raster values

```{r}

# Landcover values
landcover_values <- c(11, 21, 22, 23, 31, 41, 42, 43, 52, 72, 81, 82, 90, 95)

# Corresponding colors
landcover_colors <- c("11" = "blue", "21" = "pink", "22" = "red", "23" = "red",
                      "31" = "brown", "41" = "lightgreen", "42" = "darkgreen", 
                      "43" = "green", "52" = "tan", "72" = "yellow", 
                      "81" = "orange", "82" = "brown", "90" = "lightblue", 
                      "95" = "purple")

# Landcover labels
landcover_labels <- c("11" = "Open Water", "21" = "Developed Open, Open Space", "22" = "Developed, Low Intensity", 
                      "23" = "Developed, Medium Intensity", "31" = "Barren Land", "41" = "Deciduous Forest", 
                      "42" = "Evergreen Forest", "43" = "Mixed Forest", "52" = "Shrub/Scrub", 
                      "72" = "Grassland/Herbaceous", "81" = "Pasture/Hay", "82" = "Crops", 
                      "90" = "Woody Wetlands", "95" = "Emergent Herbaceous Wetlands")

# Assuming landcover_raster_transformed is your raster object
raster_df <- as.data.frame(landcover_raster_transformed, xy = TRUE)
colnames(raster_df) <- c("x", "y", "landcover")
raster_df$landcover <- factor(raster_df$landcover, levels = landcover_values)

ggplot(raster_df) +
  # Plot the raster
  geom_raster(aes(x = x, y = y, fill = landcover)) +
  scale_fill_manual(values = landcover_colors, labels = landcover_labels, name = "Landcover Type") +
  
  # Overlay Alabama shape
  geom_sf(data = alabama_sf, fill = NA, color = "black", size = 0.5) +
  
  # Overlay Autauga WMA
  geom_sf(data = autauga_wma_sf, fill = NA, color = "red", size = 0.5) +
  
  # Define plot labels and limits
  ggtitle("Zoomed into Autauga WMA with Landcover") +
  coord_sf(xlim = c(wma_bbox$xmin, wma_bbox$xmax), ylim = c(wma_bbox$ymin, wma_bbox$ymax), expand = FALSE) +
  
  # Adjust plot theme
  theme_minimal() +
  theme(legend.position = "right")



```


# Add Autauga WMA Legend
```{r}

install.packages("ggspatial")
library(ggspatial)


ggplot(raster_df) +
  # Plot the raster
  geom_raster(aes(x = x, y = y, fill = landcover)) +
  scale_fill_manual(values = landcover_colors, labels = landcover_labels, name = "Landcover Type") +
  
  # Overlay Alabama shape
  geom_sf(data = alabama_sf, fill = NA, color = "black", size = 0.5) +
  
  # Overlay Autauga WMA with a named color for the legend
  geom_sf(data = autauga_wma_sf, fill = NA, color = "red", size = 0.5, aes(linetype = "Autauga WMA")) +
  
  # Set the name for the linetype legend
  scale_linetype_manual(values = "solid", labels = "Autauga WMA", name = "") +
  
  # Define plot labels and limits
  ggtitle("Landcover in Autauga WMA") +
  coord_sf(xlim = c(wma_bbox$xmin, wma_bbox$xmax), ylim = c(wma_bbox$ymin, wma_bbox$ymax), expand = FALSE) +
  
  # Customize the legend to combine landcover types and Autauga WMA boundary
  guides(fill = guide_legend(order = 1), 
         linetype = guide_legend(order = 2)) +
  
  # Adjust plot theme
  theme_minimal() +
  theme(legend.position = "right") +

   # Add north arrow
  annotation_north_arrow(location = "br", which_north = "true", pad_x = unit(0.5, "in"), pad_y = unit(0.5, "in")) +
  
    # Set custom labels for axes
  labs(x = "Longitude", y = "Latitude") +
  
  # Add scale bar
  annotation_scale(location = "br", width_hint = 0.5)


```

```{r}
ggplot() +
 # Overlay Alabama shape
  geom_sf(data = alabama_sf, fill = NA, color = "black", size = 0.5) +
  
  # Add an extent rectangle for Autauga WMA with a label for the legend
  geom_rect(aes(xmin = wma_bbox$xmin, xmax = wma_bbox$xmax,
                ymin = wma_bbox$ymin, ymax = wma_bbox$ymax, linetype = "WMA Extent"),
            color = "blue", fill = NA, size = 0.5) +

    scale_linetype_manual(values = c("WMA Extent" = "dashed"), 
                        labels = c("WMA Extent"), 
                        name = "") +

    # Define plot labels
  ggtitle("Alabama with Autauga WMA Extent") +
  labs(x = "Longitude", y = "Latitude") +
  
  # Adjust plot theme
  theme_minimal() +
  theme(legend.position = "right",
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
   # Add north arrow
  annotation_north_arrow(location = "tr", which_north = "true", pad_x = unit(0.5, "in"), pad_y = unit(0.5, "in")) +
  
  # Add scale bar
  annotation_scale(location = "br", width_hint = 0.5)



```